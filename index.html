<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Heatmap Consistency Planner</title>

<style>
  :root {
    --bg-main: #1c1c1c;
    --card-bg: rgba(255,255,255,0.06);
    --outline: rgba(255,255,255,0.15);

    --gold: #d6bf73;
    --gold-light: #e6d8a3;

    --text-main: #f2f2f2;
    --text-muted: #bdbdbd;
  }

  body {
    margin: 0;
    padding: 40px;
    font-family: "Cambria Math", Cambria, Georgia, serif;
    background: #1c1c1c;
    color: var(--text-main);
  }

  h1 {
    color: var(--gold);
    margin-bottom: 20px;
  }

  .calendar {
    background: var(--card-bg);
    padding: 24px;
    border-radius: 20px;
    border: 1px solid var(--outline);
    margin-bottom: 30px;
  }

  .calendar-scroll {
    overflow-x: auto;
  }

  .months {
    display: grid;
    grid-template-columns: repeat(53, 22px);
    gap: 8px;
    margin-left: 36px;
    margin-bottom: 12px;
    font-size: 13px;
    color: var(--gold-light);
    min-width: max-content;
  }

  .heatmap-area {
    display: flex;
    gap: 14px;
    min-width: max-content;
  }

  /* ✅ MONDAY-FIRST */
  .weekdays {
    display: grid;
    grid-template-rows: repeat(7, 22px);
    gap: 8px;
    font-size: 12px;
    color: var(--text-muted);
  }

  .heatmap {
    display: grid;
    grid-auto-flow: column;
    grid-template-rows: repeat(7, 22px);
    grid-auto-columns: 22px;
    gap: 8px;
  }

  .day {
    width: 22px;
    height: 22px;
    border-radius: 6px;
    background: rgba(255,255,255,0.08);
    cursor: pointer;
  }

  .day.selected {
    outline: 3px solid var(--gold);
  }

  .lvl-0 { background: rgba(255,255,255,0.08); }
  .lvl-1 { background: #e6d8a3; }
  .lvl-2 { background: #d6bf73; }
  .lvl-3 { background: #c9a94a; }
  .lvl-4 { background: #b8962e; }

  /* ===== PLANNER ===== */

  .planner {
    background: var(--card-bg);
    padding: 24px;
    border-radius: 20px;
    border: 1px solid var(--outline);
  }

  .actions button {
    margin-right: 10px;
    background: var(--gold);
    border: none;
    padding: 8px 14px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
  }

  .task-input {
    margin-top: 20px;
    display: none;
  }

  .task-input input {
    width: 70%;
    padding: 8px;
    border-radius: 8px;
    border: none;
    margin-right: 10px;
  }

  .task-input button {
    padding: 8px 14px;
    border-radius: 8px;
    border: none;
    background: var(--gold);
    cursor: pointer;
    font-weight: 600;
  }

  /* ✅ STACKED STICKY NOTES */
  .tasks {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .task-card {
    background: #fef3c7;
    color: #1c1c1c;
    padding: 14px;
    border-radius: 12px;
    width: 100%;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 15px;
  }
</style>
</head>

<body>

<h1>Heatmap Consistency Planner</h1>

<div class="calendar">
  <div class="calendar-scroll">
    <div class="months" id="months"></div>
    <div class="heatmap-area">
      <div class="weekdays">
        <div>Mon</div><div>Tue</div><div>Wed</div>
        <div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
      </div>
      <div class="heatmap" id="heatmap"></div>
    </div>
  </div>
</div>

<div class="planner">
  <h2 id="selectedDate">Select a day</h2>

  <div class="actions">
    <button onclick="showAdd()">+ Add New Task</button>
    <button onclick="renderTasks()">Edit Tasks</button>
  </div>

  <div class="task-input" id="taskInput">
    <input type="text" id="taskName" placeholder="Enter task name">
    <button onclick="saveTask()">Save Task</button>
    <button onclick="cancelTask()">Cancel</button>
  </div>

  <div class="tasks" id="tasks"></div>
</div>

<script>
const heatmap = document.getElementById("heatmap");
const monthsDiv = document.getElementById("months");
const tasksDiv = document.getElementById("tasks");
const selectedDateEl = document.getElementById("selectedDate");
const taskInput = document.getElementById("taskInput");

const year = 2026;
const data = JSON.parse(localStorage.getItem("plannerData")) || {};
let selectedDate = null;

const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function save() {
  localStorage.setItem("plannerData", JSON.stringify(data));
}

/* ✅ MONDAY-FIRST DAY INDEX */
function getMondayIndex(date) {
  return (date.getDay() + 6) % 7;
}

function completionLevel(tasks) {
  if (!tasks || tasks.length === 0) return 0;
  const done = tasks.filter(t => t.completed).length;
  const pct = (done / tasks.length) * 100;
  if (pct === 0) return 0;
  if (pct <= 25) return 1;
  if (pct <= 50) return 2;
  if (pct <= 75) return 3;
  return 4;
}

function render() {
  heatmap.innerHTML = "";
  monthsDiv.innerHTML = "";

  const start = new Date(year,0,1);
  const startDay = getMondayIndex(start);
  let date = new Date(start);
  let currentMonth = -1;

  for (let i = 0; i < startDay; i++) {
    heatmap.appendChild(document.createElement("div"));
  }

  while (date.getFullYear() === year) {
    if (getMondayIndex(date) === 0) {
      const m = date.getMonth();
      monthsDiv.appendChild(
        m !== currentMonth
          ? Object.assign(document.createElement("div"),{textContent:monthNames[m]})
          : document.createElement("div")
      );
      currentMonth = m;
    }

    const key = date.toISOString().split("T")[0];
    const tasks = data[key] || [];
    const cell = document.createElement("div");
    cell.className = `day lvl-${completionLevel(tasks)}`;
    cell.onclick = () => selectDay(key, cell);

    heatmap.appendChild(cell);
    date.setDate(date.getDate() + 1);
  }
}

function selectDay(key, cell) {
  selectedDate = key;
  selectedDateEl.textContent = key;
  document.querySelectorAll(".day").forEach(d => d.classList.remove("selected"));
  cell.classList.add("selected");
  renderTasks();
}

function showAdd() {
  if (!selectedDate) return alert("Select a day first");
  taskInput.style.display = "block";
}

function cancelTask() {
  taskInput.style.display = "none";
  document.getElementById("taskName").value = "";
}

function saveTask() {
  const name = document.getElementById("taskName").value.trim();
  if (!name) return;

  data[selectedDate] = data[selectedDate] || [];
  data[selectedDate].push({ name, completed: false });
  save();
  cancelTask();
  renderTasks();
  render();
}

function renderTasks() {
  tasksDiv.innerHTML = "";
  const tasks = data[selectedDate] || [];

  tasks.forEach((t, i) => {
    const card = document.createElement("div");
    card.className = "task-card";
    card.innerHTML = `
      <input type="checkbox" ${t.completed ? "checked" : ""} 
        onchange="toggleTask(${i})">
      ${t.name}
    `;
    tasksDiv.appendChild(card);
  });
}

function toggleTask(i) {
  data[selectedDate][i].completed = !data[selectedDate][i].completed;
  save();
  render();
}

render();
</script>

</body>
</html>
